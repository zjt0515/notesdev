

> 嵌入式系统是以应用为中心，以计算机技术为基础，软硬
> 件可裁减，以适应应用系统对功能、可靠性、成本、体积、
> 功耗严格要求的专用计算机系统。
>
> 国外定义：用于控制、监视或者辅助操作机器和设备的装置

## 分类

![image-20250103230605029](images/image-20250103230605029.png)



## 结构和原理

## 内部结构和引脚功能

CPU: 8位，

存储器：

1. ROM, 4kB
2. ram, 128B

IO接口

1. 并口，4个8bit
2. 串口
3. 定时计数器
4. 中断原

## CPU

> 单片机的核心部件是一个8位高性能的微处理器，它是计算机中运算器和控制器的总称，是单片机的指挥中心和执行机构；
> 微处理器在单片机运行的过程中产生合适的时序信号，指挥并控制单片机的有关部件和器件，读入和分析每条指令代码，并具体执行每条指令代码指定的操作；
> 单片机的微处理器由8位运算器（算术/逻辑运算单元） ALU、布尔处理器、时序和控制部件以及若干寄存器等主要部分组成。

>  CPU组成
>
> 1. 运算器
> 2. 控制器

### 运算器

用于实现算术和逻辑运算，包括：

1. 累加器ACC：8位寄存器，可以存放操作数
2. PSW程序状态字
    1. Cy进位标志位：算数/逻辑运算时有无进位/借位
    2. Ac辅助进位标志位：BCD运算时，低四位是否有进为/借位
    3. F0用户设定标志位: 控制程序流向
    4. RS1，RS0:选择片内RAM中的4组工作寄存器
    5. OV溢出标志位：有无溢出
    6. PSW.1:保留位
    7. P:奇偶标志位：A中1的个数是否为奇数，**数据用BCD表示**
3. 算术逻辑单元 ALU：8位变量进行算数/逻辑运算
4. 寄存器B：8位辅助寄存器，为ALU乘除法运算设置
5. 暂存器1，2

### 控制器

1. 程序计数器PC：CPU**下一条执行指令的地址**，16位寄存器
2. PC+1计数器
3. 指令寄存器IR：暂存指令，译码后由定时和控制电路发出控制信号
4. 指令译码器
5. 时序及控制电路
6. 堆栈指针SP：
7. 数据指针寄存器DPTR：16位寄存器，高位字节DPH，低位字节DPL

### 内部数据存储器

内部128字节的RAM(针对MCS-51单片机)；
l 内部256字节的RAM(针对MCS-52单片机)；

### 内部程序存储器

早期版本的MCS-51无内部程序存储器；
l 扩展型MCS-51片内包含容量不等(1K~64K)的程序存储器；
l 内部程序存储器种类包括ROM、EPROM、Flash等。

###  并行IO端口

### 定时器/计数器

2个16位定时器/计数器T0和T1；

> 52单片机内部增加了一个16位定时器/计数器T2

### 串行通信接口

内部有1个全双工的UART(通用串行收发器)，可设置为多种工作模式；

### 中断控制系统

内部有5个中断源；可分为2个中断优先级；

###  时钟电路

51单片机内部振荡电路配合外部晶振或外部输入的时钟信
号，可产生时钟脉冲序列，控制CPU内部逻辑电路运行。



其他寄存器

1. DPTR，数据指针
2. SP 堆栈指针

时钟产生方式

1. 内部时钟方式
    1. 18、19引脚时钟接口
2. 外部时钟方式
    1. 18、19



单片机复位：使系统处于初始状态

```c
PC=0000H;
RAM=随机值;
SFR:
p0-p33=FFH;
SP=07H;
IP = IE = PCON = 0;
PSW=00H
```



看门狗定时器WDT：程序陷入死循环时，触发单片机复位

## 存储器组织

> 存储器是组成计算机的三大主要部件之一。
> l 存储器的功能是存储信息，包括程序和数据，存储这两种
> 信息的存储器分别被称为程序存储器和数据存储器。
>
> 

### 存储系统结构

RAM: 内存

ROM：磁盘

单片机的存储系统的结构有两种类型：
Ø冯•诺依曼结构：程序存储器和数据存储器在一个存储地址区间统
一编址；
Ø哈佛结构：程序存储器和数据存储器在不同的存储空间各自独立
编址；
l MCS-51采用的是哈佛结构。它的存储系统分为多个存储空
间，结构较为复杂。

![image-20250103231745722](images/image-20250103231745722.png)

![image-20250103231802111](images/image-20250103231802111.png)

存储系统编址：

![image-20250104161304367](./images/image-20250104161304367.png)

### 程序 存储器

![image-20250104161242234](./images/image-20250104161242234.png)

### 外部数据存储器

![image-20250104161101136](./images/image-20250104161101136.png)

###  内部数据存储器

![image-20250104161109224](./images/image-20250104161109224.png)

![image-20250104161122368](./images/image-20250104161122368.png)

![image-20250104161132303](./images/image-20250104161132303.png)

![image-20250104161141806](./images/image-20250104161141806.png)

![image-20250104161154852](./images/image-20250104161154852.png)

![image-20250104161204180](./images/image-20250104161204180.png)

### 特殊功能寄存器

定时器/计数器 16位 3个 

> ![image-20250104160950921](./images/image-20250104160950921.png)

![image-20250104161001397](./images/image-20250104161001397.png)

![image-20250104161008369](./images/image-20250104161008369.png)

![image-20250104161017786](./images/image-20250104161017786.png)

## 并行IO端口结构功能

### P0

P0端口的8个引脚分别表示为P0.0~P0.7;P0为多功能端口；

1. 功能一：为双向的、可位寻址的8位I/0端口，既可按字节进行8位的数据输入/输出，又可以按位单独进行输入/输出操作；
2. 功能二：在单片机扩展系统总线时，它分时提供低8位地址总线及数据总线；

![image-20250104161815424](./images/image-20250104161815424.png)

### P1

P1端口是一个标准的准双向端口；
ØP1内部取消了上拉的FET，而以一个上拉电阻代替；
Ø因P1内部上拉电阻阻值较大，故上拉驱动能力较弱，除了有低功耗要求的应用系统，最好外接10K左右的上拉电阻；
ØP1内部下拉FET仍存在，因此P1在作为输入时，仍需先向端口数据锁存器输出1，使输出驱动FET截止，保证数据读入的正确性；

### P2

P2端口是一个准双向端口；
ØP2端口在系统扩展外围总线时输出高8位地址，此时P2不可作为通用I/O端口使用；
ØP2端口输出高8位地址时，硬件电路自动设置“控制”线使二选一复用器倒向“地址”端，使输出的高8位地址输出到P2.x引脚；
Ø当P2端口作为通用I/O使用时，单片机控制二选一复用器倒向P2.x锁存器的Q端，此时P2端口的功能和使用方法都类似于P1端口；
Ø系统复位时，端口锁存器自动置1，输出的下拉驱动器截止，P2端口可直接作为输入口使用。

### P3

当P3端口使用第一功能（通用I/O口）输出数据时，“第二输出功能”信号应保持高电平，使与非门开锁，此时端口数据锁存器的输出端Q可以控制P3.x引脚上的输出电平；
Ø当P3端口使用第二输出功能时，P3端口对应位的数据锁存器应置1，使与非门开锁，此时“第二输出功能”输出的信号可控制P3.x引脚上的输出电平；

当P3端口作为输入端口时，无论输入的是第一功能还是第二功能的信号，相应位的输出锁存器和“第二输出功能”信号都应保持为1，使下拉驱动器截止； 
Ø输入部分有两个缓冲器，第二功能专用信息的输入取自和P3.x引脚直接相连的缓冲器，而通用I/O端口的输入信息则取自由“读引脚”信号控制的三态缓冲器的输入，经内部总线送至CPU。

### 读/修改/回写操作



![image-20250104161604151](./images/image-20250104161604151.png)

![image-20250104161553149](./images/image-20250104161553149.png)

![image-20250104161544353](./images/image-20250104161544353.png)

## 单片机封装

![image-20250104155649197](./images/image-20250104155649197.png)

## 单片机复位

> 在单片机的RST引脚上保持2个机器周期以上的高电平，单片机即复位；
> 只要RST引脚保持高电平，单片机就循环复位。当RST从高电平变为低电平后，MCS-51从0000H地址开始执行程序。只要RST/VPD引脚输入的高电平不撤除，单片机就一直保持复位状态。
> 单片机复位完成后，其内部各寄存器恢复到初始状态。各寄存器复位后的初始值如下页表所示：

![image-20250104160645149](./images/image-20250104160645149.png)

## 引脚

> [!tip]
>
> 引脚上方有横线：低电平有效

1. 电源及时钟引脚
2. 控制引脚
3. IO引脚

| 引脚           | id                                                        |      |
| -------------- | --------------------------------------------------------- | ---- |
| 电源及时钟引脚 | 18、19、Vss20、Vcc40                                      |      |
| 控制引脚       | 29、30、31、9                                             |      |
| IO引脚         | P0、P1、P2、P3 4个8位=32位<br />1-8, 10-17, 21-28， 32-39 |      |

地址线：16位，P0+P2，其中P0也可以作为数据线使用

### 电源及时钟引脚

> 所有引脚号均以DIP40封装为例。低有效信号由前缀“n”或“#”或添加上划线表示

1. Vcc +5v 供电，目前有多种供电电压以及一些宽电压范围的单片机。最常用的供电电压为+5V
2. Vss GND
3. XTAL1  (19)单片机内部晶体振荡电路的反相器的输入端；
    1. 使用片内振荡器，，接外部石英晶体和微调电容
    2. 外接时钟源，接外部时钟振荡器信号
4. XTAL2 (18)单片机内部晶体振荡电路的反相器的输出端；
    1. 同上
    2. 外接时钟源时，悬空

### 控制引脚

1. PSEN(29): 片外程序存储器读选，信号输出端
    1. 外部程序存储器（ROM）的读选通信号。当CPU访问外部ROM时，PSEN产生负脉冲作为外部ROM的选通信号；而当CPU访问外部RAM或片内ROM时，不会产生有效的PSEN信号；
    2. PSEN信号可驱动8个LS TTL负载。

2. ALE/PROG(30): 输出信号；
    1. ALE：地址锁存控制信号。ALE为地址锁存允许信号。在访问外部存储器时，ALE用来锁存P0端口输出的低8位地址信号。在不访问外部存储器时，ALE也以时钟振荡频率的1/6的固定速率输出，可作为时钟输出；
    2. PROG片内flash编程时作为脉冲输入脚 ，对8751内部EPROM编程时的编程脉冲输入端。
3. EA/VPP(31) : 输入信号；
    1. EA: 外部程序存储器访问允许控制端， 访问外部程序存储器的控制(使能)信号；
        ØEA接地，单片机固定从外部程序存储器取指令； 
        ØEA接高，单片机首先访问内部程序存储器，当访问地址超过
        内部程序存储器范围时，自动访问外部程序存储器；
    2. Vpp 片内flash编程时接编程电压
    3. 该引脚还用于外部编程器对内部程序存储器编程时输入编
        程电压。
4. RST(9)
    1. 第9脚，输入信号。RST为复位信号输入端。单片机正常工作时RST引脚应保持低电平；
    2. 在RST引脚上输入两个机器周期(24个时钟周期)以上的高电平时，单片机将进入并保持复位状态，直到RST信号重回低电平。VPD为内部RAM的备用电源输入端。如果主电源VCC发生断电或电压降到一定值时，可通过VPD为单片机内部RAM提供电源，以保证片内RAM中的信息不丢失。


### IO引脚

1. P0(39-32): 8位并行双向IO口，可以做地址线/数据线，分时复用
    1. 在扩展外部总线时，分时作为低8位地址总线和8位双向数据总线；
    2. 可驱动8个LS TTL负载。

2. P1(1-8)：准双向，引脚内部接有上拉电阻
    1. 具有内部上拉电路的8位准双向I/O端口；
    2. 可驱动4个LS TTL负载。

3. P2(21-28)：准双向
    1. 具有内部上拉电路的8位准双向I/O端口；
    2. 在扩展外部总线时，用作高8位地址总线；
    3. 可驱动4个LS TTL负载。

4. P3(10-17): 准双向，有第二功能
    1. 具有内部上拉电路的8位准双向I/O端口；
    2. 该端口的每一位都可以作为其它功能模块的输入/输出及控制引脚使用，具体定义如下：
    3. ![image-20250104160247548](./images/image-20250104160247548.png)


| P3   | 第二功能 | 注释                   |
| ---- | -------- | ---------------------- |
| P3.0 | RXD      | 串行口数据输入         |
| 1    | TXD      | 串行口数据输出         |
| 2    | INT0     | 外部中断0输入          |
| 3    | INT1     | 外部中断1输入          |
| 4    | T0       | 定时器0外部输入        |
| 5    | T1       | 定时器1外部输入        |
| 6    | WR       | 片外数据存储器写选通端 |
| 7    | RD       | 片外数据存储器读选通端 |

> [!tip]
>
> 双向和准双向：
>
> 准双向实际 是一种输出状态
>
> 双向在输入时，输出部分断开，端口浮空高祖态

## 单片机最小系统

用最基本最少的元件组成系统

1. 单片机芯片
2. 电源电路
3. 晶振电路
4. 复位电路