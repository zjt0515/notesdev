# 数据包格式

## IPv4数据报首部格式

1. 20字节固定部分：必须包含
2. 40字节可变部分：可选字段

每一行：4字节，即32bit

1. 版本0.5+首部长度0.5，区分服务1，总长度2
2. 标识2，标志+片偏移
3. 

| 首部字段      | 描述                                                         | 大小            |
| ------------- | :----------------------------------------------------------- | --------------- |
| 版本          |                                                              |                 |
| 首部长度      | 最小0101，十进制为5，含义是首部为5*4字节<br />最大1111，十进制为15，首部60字节 | 0.5字节=4bit    |
| **区分服务**  | 使用区分服务时生效，一般不使用<br />用来获得更好的服务，不同数值提供不同等级的服务质量 | **1字节=8bit**  |
| ==总长度==    | 首部+数据载荷的总长度，这里不用*4<br />最大65535字节         | ==2字节=16bit== |
|               | 分片相关字段                                                 |                 |
| ==标识==      | 同一个数据报的**各分片**数据报的标识相同<br />每产生一个IP数据报，计数器+1并赋值给标识 | ==2字节=16bit== |
| 标志          | MF位：1后面有分片，0后面无分片<br />DF位：1不允许再分片，0允许分片<br />保留位：0 | 0.375字节=3bit  |
| 片偏移        | 分片数据报的数据载荷部分**相对最原始**数据报数据载荷部分的偏移，单位为8字节 | 1.625字节=13bit |
|               |                                                              |                 |
| 生存时间      | 路由器转发-1，为0时丢弃IP数据报<br />防止IP数据报永久兜圈    | 1字节=8bit      |
| 协议          |                                                              |                 |
| 首部检验和    |                                                              |                 |
|               |                                                              |                 |
| 可选字段+填充 | 排错、测量、安全等措施，也会增加处理开销，很少使用<br />全0填充确保首部长度为4的整数倍 | 1~40字节        |

> 数据载荷长度=总长度-首部长度=总长度字段值-首部长度字段值*4
>
>  最大传输单元MTU：IP数据报在数据链路层封装成帧，数据链路层协议规定帧的数据载荷的最大长度
> 以太网MTU：1500字节
>
> IP数据报总长度 > MTU时，将IP数据报分片为更小的IP数据报，再将分片封装成帧

![image-20241217104419440](./images/image-20241217104419440.png)



## HTTP

![image-20241216214636595](./images/image-20241216214636595.png)

## TCP三次握手

> TCP三次握手
>
> 1. 客户端发送SYN包，尝试连接服务器
> 2. 服务器响应SYN+ACK包，确认收到连接
> 3. 客户端发送ACK包，确认连接成功
>
> TCP报文
>
> 1. 源IP
> 2. 目标IP
> 3. 源端口
> 4. 目标端口
> 5. 序号
> 6. 确认号
> 7. SYN和ACK标志位



SYN和ACK区分第几次握手

1. SYN=1
2. SYN=1 ACK=1
3. ACK=1



![image-20241216212540293](./images/image-20241216212540293.png)

![image-20241216212551938](./images/image-20241216212551938.png)

![image-20241216212601160](./images/image-20241216212601160.png)

![image1-20241216213218199](./images/image-20241216213218199.png)