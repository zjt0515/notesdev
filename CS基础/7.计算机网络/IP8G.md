

## IP协议相关技术

### DNS

> 域名解析流程 www.server.com
>
> 1. 客户端发送DNS请求
> 2. 本地DNS服务器接受请求，查询
> 3. 根DNS服务器接收本地DNS请求，返回`顶级域名服务器地址
> 4. 本地DNS接收地址，发送请求
> 5. 顶级域名服务器接收请求，返回`server.com`权威DNS服务器地址
> 6. 本地DNS接收地址，发送请求
> 7. 权威DNS服务器接收请求，查询后返回对应的IP地址
> 8. 本地DNS接收并返回IP给客户端，客户端和目标建立连接

### ARP



### DHCP



### NAT

网络地址转换NAT方法，缓解IPv4

网络地址与端口转换 NAPT

### ICMP



### IGMP

## ICMP协议——ip协议的助手

ICMP协议：Internet Control Message Protocol 互联网控制报文协议

功能：

1. 确认IP包是否发送成功
2. 如果失败，确认IP包被废弃的原因
3. 改善网络设置

### ICMP差错报文类型

1. 目标不可达消息  3 无法发送到目的地址
   1. 网络不可达 0
      
   2. 主机不可达 1
      路由表中没有目的主机信息/目的主机没有联网
   3. 协议不可达 2
      对端主机防火墙禁止TCP协议访问
   4. 端口不可达 3
      对端主机没有进程监听 8080端口
   5. 需要进行分片但设置不了分片 4
      IP数据包首部的分片禁止标志位设置1，途中的路由器遇到超过MTU大小的数据包时不分片，直接抛弃，此时，发送包含ICMP不可达消息的报文，代码为4
2. 原点抑制消息 4 
3. 重定向消息 5
   路由器发现发送端主机使用了**并非最优**的 路径发送数据
   该消息包含了最适合的路由信息和源数据
4. 超时消息 11
   当IP包中的TTL减少到0时发送 ，通知该包已经被丢弃

### ICMP查询报文类型

回送消息：通信主机或路由器之间，判断数据包是否成功发送到对端的消息

1. 回送应答 0
   目标主机收到回送请求后，响应一个回送应答
2. 回送请求 8
   发送主机发送，可以测试网络连通性和延迟

> 回送请求报文
>
> 类型8，序号初始化1
> 发送时间

### ICMP数据包字段

1. 类型（查询和差错报文两大类）
   1. **回送**应答 0
   2. 目标不可达 3
   3. 原点抑制 4
   4. 重定向/改变路由 5
   5. **回送**请求 8 
   6. 超时 11
2. 代码
3. 校验和
4. [标识符] 区分发送ICMP包的应用程序
5. [序号] : 发送回送请求次数
6. 数据内容

## ping的工作原理

ping的过程

1. 源主机构建ICMP**回送请求**消息数据包
2. ICMP协议将数据包和目的地址交给IP层
3. IP层构建数据包
   1. 协议字段：1 表示ICMP协议
   2. 加入MAC头
4. 目的主机接收数据帧，检查MAC地址
5. 提取IP数据包，交给本机的IP层，提取信息后交给ICMP协议，构建回送响应消息数据包
6. 源主机没有在规定时间是收到应答包→主机不可达，反之→主机可达