# 链路层

> 帧：点对点信道的协议数据单元
>
> 链路控制三大功能：
>
> 1. 封装成帧: 数据的前后部分添加帧首部尾部，**IP数据报作为 帧的数据部分**
>    帧定界符SOH/EOT：特殊的八位二进制数，可以确定帧的界限
>
>    最大传输单元MTU：帧的数据部分/IP数据报存在大小上限，一般是1500字节
>
> 2. 透明传输：无论数据的比特组合，都能在链路上传输
>    字符/字节填充法解决透明传输（转移字符）：发送方发现数据部分存在和控制信息相同的比特组合时，填充转义字符
>
> 3. 差错检测：发现错误直接丢弃
>
>    1. 位错：循环冗余检验CRC
>    2. 帧错 丢失/重复/失序：
>       1. 丢失：计时器超时重传
>
> 为网络层提供的服务：
>
> 1. 无/有确认的无连接服务
> 2. 有确认的面向连接服务（有连接一定有确认）
>
> 链路层使用的信道类型：
>
> 1. 点对点信道：一对一
> 2. 广播信道：一对多

> [!caution]
>
> 没有封装成帧：无法区分数据和控制信息
>
> 为什么不做可靠的数据链路层：会牺牲实时性

无比特差错和无传输差错：

1. 无比特差错：
2. 无传输差错：

## 题目：CRC冗余循环差错检测过程

1. 准备数据，多项式为r+1位
2. 每个组加上冗余码构成帧
3. 接收方检验：d+r / 生成多项式
   1. 有余数丢弃
   2. 无余数接收

二进制除法时，相减使用异或，同0异1

> [!ques]
>
> 发送的数据是1101 0110 11，采用CRC校验，生成多项式是10011, 最终发送的数据是？
>
> [!ans]
>
> 1. r+1 = 5, 则数据后补上4个0
> 2. 帧检验序列FCS= (1101 0110 11 0000) / 10011的余数
> 3. 最终发送数据：要发送数据+FCS

HDLC协议，避免比特串中出现与帧定界符相同的序列，使用比特填充机制：出现连续的5个1，后插一个0

> [!ques]
>
> 1、HDLC帧中部分数据比特为“0111101111110”，经过填充后出现在链路上的比特序列是什么？
>
> [!ans]
>
> 01111011111010

## 点对点PPP协议

> 1. 简单
> 2. 封装成帧，帧定界符
> 3. 透明性

PPP协议实现**透明传输**的两种方法：

1. 异步传输：字节填充法
   信息字段中的0x7E -> 0x7D,0x7E
   信息字段中的0x7D -> 0x7D,0x5D
   信息字段中数值小于0x20的字符x -> 0x7D,x，同时编码改变
2. 同步传输：零比特填充法，标识字段F为01111110
   11111→111110
   接收端扫描时对连续的5个1删除后置0

### PPP帧格式

| 字段               | 描述            |      |
| ------------------ | --------------- | ---- |
| F7E                |                 |      |
| AFF                |                 |      |
| C03                |                 |      |
| 协议               |                 |      |
| 信息部分(IP数据报) | 不超过1500字节  |      |
| 尾部               |                 |      |
| FCS                | CRC冗余循环使用 |      |
| F7E                |                 |      |



> [!warning]
>
> 为什么PPP不适用帧的编号：链路层不需要可靠传输
>
> 

## HDLC协议

HDLC协议实现透明传输：零比特填充，51加0

> [!ques]
>
> 01111100 01111110组帧后对应的比特串：011111000 011111010

## 停止等待协议SW

1. A发送
2. B接收，返回确认分组
3. A接收到确认，继续发送

### 信道利用率计算

$$
U=\frac{帧发送时间}{帧发送时间+往返时延}\\=\frac{T_D}{T_D+RTT(+T_A)}\\
T_D:数据帧发送时延\\
RTT:收发双方的往返时间=2*单程传播时延\\
(T_A:确认分组的发送时延(一般题目会忽略))\\
$$

> [!ques]
>
> 信道长度2000km，数据分组长度1500B，发送速率10Mbit/s(忽略T_A，远小于T_D)
> $$
> T_D=\frac{数据长度}{发送速率}=1500*8bit/10*10^6bit/s\\
> RTT=\frac{信道长度}{光速}*2=2000*10^3m/2*10^8m/s*2\\
> U=\frac{1.2}{1.2+20}=5.66%
> $$
> 数据传输速率3kbps，单向传播时延200ms，忽略确认帧的传输时延，信道利用率=40%，求数据帧长度= 800B

## 连续ARQ协议



> 发送窗口W~s~和接收窗口W~r~：
> $$
> W_s+W_r<=2^m\\
> 发送窗口的最大尺寸：2^m-W_r=2^m-1\\
> m:帧序号的比特长度\\
> 接收窗口固定为1，接收方只会累计确认ACK
> $$
> 
>
> 
>
> 


## MAC帧格式

针对广播信道

| 字段     | 描述 | 字节大小 |
| -------- | ---- | -------- |
| 目的地址 |      | 6        |
| 源地址   |      | 6        |
| 类型     |      | 2        |
| 数据     |      | 46-1500  |
| FCS      |      | 4        |
|          |      |          |

## 局域网的数据链路层

> 局域网：一个小区域，具有广播功能，

## CSMA/CD协议

> 介质访问控制：
>
> 1. 静态划分信道
> 2. 动态分配信道
>    1. 随机接入，CSMA/CD协议
>

CS：载波监听，发送数据前和发送数据时都要检测其他计算机是否在发送

MA：多点接入，总线型网络

CD：碰撞检测，边发送边监听

半双工, 局域网广播信道使用

检测到冲突时，停止发送，等待空闲时间

### 局域网

> 局域网：某区域内多台计算机互联成的计算机组，使用广播信道
>
> 1. 覆盖范围小，通信延迟短，传输速率高，具有广播功能
> 2. 有线局域网：双绞线，光纤，同轴电缆
> 3. 无线局域网：红外，微波

以太网：使用CSMA/CD技术

计算机通过适配器/网卡连接到局域网/以太网




## 重要网络

### 局域网LAN

> 1. 地理范围小
> 2. 双绞线、同轴电缆
> 3. 通信延迟时间短，误码率低，可靠性高
> 4. 具有广播功能

### 计算

> [!ques]
>
> 1、A、B两站位于长4km的基带总线局域网的两端，数据传输速率为20Mbps，信号传播速度为2×10^8^m/s， 
>
> 1. 该基带总线局域网内的最短帧长。
> 2. 若A站点给B站点发送数据时，已经发生了2次冲突，站点可供选择的最大退避系数是多少？
> 3. 若从A站发送数据开始， 到B站接收完A站发送来的一个长度是2000比特的数据帧所需的时间是多少微秒？
>
> $$
> 最短帧长=R*传播时延=2R单程传播时延\\
> 最大退避系数=2^n-1(n<=10)\\
> 总时间=发送时间+单程传播时延\\
> 发送时间=\frac{数据长度}{传输速率}\\
> 单程传播时延=\frac{距离}{信号传播速度}
> $$
>

## 链路层设备