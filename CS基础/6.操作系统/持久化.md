## 文件，文件系统 

> 文件：以硬盘为载体，存储再计算机上的信息集合，计算机以进程为基本单位进行资源调度分配，用户以文件为基本单位进行输入输出
>
> 文件属性：名称/类型/位置/大小/保护/时间/用户标识
>
> 文件操作：增删改查、重定位和截断

创建文件的过程

1. 在文件系统中找到空间
2. 在目录中新建条目，记录文件名称、位置...

写文件

1. 执行一个系统调用，传入文件名称和写入内容
2. 系统搜索目录查找位置，维护一个写位置的指针

读文件

1. 执行一个系统调用，传入文件名称和要读入的文件块的内存位置
2. 同上

文件重定位

1. 按某条件搜索目录，将当前文件位置设为给定值，不会读写文件

删除文件

1. 搜索目录，删除文件的目录项，删除文件控制块，释放文件关联的内存缓冲区
2. 回收占用的存储空间

截断文件

1. 允许文件所有属性不变，然后删除文件内容

打开/关闭：open 和 close系统调用

### 文件系统的层次结构

| 层次                                                         | 用途                                                         |      |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ---- |
| 用户                                                         | 处理系统调用                                                 |      |
| 文件目录                                                     | 根据文件路径找到响应的索引结点，其他目录管理工作             |      |
| 存取控制模块                                                 | 验证访问权限，文件保护                                       |      |
| 逻辑文件系统和文件信息缓冲区                                 | 将记录号转换为逻辑地址                                       |      |
| 物理文件系统                                                 | 将文件逻辑地址转换为实际的物理地址                           |      |
| 辅助分配模块+负责文件存储空间的管理(分配和回收存储空间)+设备管理模块 | 直接与硬件交互，如分配+ 启动释放设备，分配设备缓冲区，磁盘调度， |      |

### 文件逻辑结构

1. 流式文件
2. 记录式文件
    1. 顺序文件
    2. 索引文件
    3. 索引顺序文件
    4. 记录式文件

## 文件目录

> 文件控制块FCB：存放控制文件需要的各种信息的数据结构，实现按名存取
>
> 一个FCB就是一个文件目录项，创建新文件，系统分配一个FCB并存放在文件目录中，成为目录项
>
> FCB的内容信息：文件名/物理位置/逻辑结构/物理结构/存取控制信息

目录结构：

1. 单级目录结构
2. 两级目录结构，文件目录和用户文件目录
3. 多级目录结构（树形目录结构）
4. 无环图目录结构：实现文件共享



索引结点：存放除了文件名之外的所有信息

目录项只包含文件，索引结点指针，减少目录项长度

## 文件共享和保护

文件共享

### 基于索引结点共享（硬链接）

索引结点中设置链接计数变量count：标识链接到该结点的用户目录项数
例如，count=2表示2个用户共享文件

一个用户删除该文件：用户目录中与该文件对应的目录项删除，count--
count>0，不能删除文件数据

### 基于符号链的共享方式（软链接）

链接父目录

### 口令保护

为文件设置一个口令，系统验证口令，实现开销小，口令存放在FCB/索引结点中不安全

### 加密保护

安全性高，加密解密有开销

### 访问控制

用一个访问控制表ACL用户对文件的访问权限

实现灵活

## 磁盘结构

> 磁盘：表面涂有磁性物质的金属构成的圆形盘片，通过固定磁头读取数据，磁盘高速旋转 
>
> 磁道：盘面上的数据存储在的一组同心圆，磁道又分为几百个扇区(盘块)，每个扇区存储512B
>
> 磁盘驱动器，磁头臂 

## 磁盘调度算法



## 磁盘管理

