# LR0、LR1、SLR

## LR0

### 拓广文法->列项目->构建项目集


LR文法采用最左归约，每次选择最左句柄进行归约（所有两代子树中最左边的



> [!note]
>
> 概念
>
> 拓广文法：$S'->S$
>
> 项目：对每个产生式的右部添加一个·，右部有n个元素就可以产生n+1个项目
> 项目类型分类：
>
> - 接受项目：开始符号的归约项目$S'->S·$
> - 归约项目：·在产生式右部的最后面，代表可以进行一次规约$A->a·$
> - 移进项目：·的右边是终结符$A->·a$
> - 待约项目：·的右边是非终结符$A->·B$
>
> 内核项：开始项和·不在最左端的所有项目
> 非内核项：

![image-20240611085240365](./images/image-20240611085240365.png)

求项目集的闭包：

1. 将项目集所有项目加到闭包
2. 检查每个项目，如果$·$右边是非终结符，将此非终结符的项目集加入闭包（·在不同位置的，取第一个即可）
3. 继续对新增加的项目求闭包，直到闭包没变化

![image-20240629002703086](./images/image-20240629002703086.png)



### 构造LR状态转换图（DFA图

构造LR状态转换图：

1. 构造$I_0$
    1. 求核心项目的闭包
2. 检查$I_0$中的每个项目，看能接受什么符号，引出下一个状态
3. (如果不存在)构造下一个状态，直到没有新状态

![image-20240620003447161](./images/image-20240620003447161.png)

### 构造LR0自动机

> [!note]
>
> 自动机的接受状态：核心项目中包含归约项目
>
> 最终状态不是接受状态，就不是活前缀



![image-20240617211245540](./images/image-20240617211245540.png)

是否为LR0文法：是否有冲突

### 构造分析表(状态+action+goto)

> - acc：最终结束，看接受项目在哪，只出现在#一列
> - $sn$：shift移入，$action(k,a)=sn：状态k遇到符号a，将状态m'和输入符号a压入栈$
> - $rj$：归约，$action(k,follow(A))=rj：状态m遇到符号a，用第j条产生式归约$
>     - 同时，弹出$length(j产生式右部)$​​​个符号
>
> 总结：
>
> s和goto后面写的都是下一个状态
>
> r后面写的是产生式的标号

遍历每个状态的所有项目

1. 移进项目$I_k：A->·a，a->I_{next}$ ：$action(k,a)=S_{next}$（·后面是终结符，在对应action位置填S~next~​
    1. 对于待约项目$I_k：A->·B$ ：$goto(k,B)=next$，（·后面是非终结符就直接在goto中写next
2. (·在最右边)归约项目$I_k：A->a·$ ：$action(k,FOLLOW(A))=rj(j是产生式)$（·在最右边，需要查产生式标号​和**查FOLLOW集**
3. 接受项目$I_k：S'->S·$ ：$action(k,\#)=acc$

 注意：FOLLOW集合中也有可能有#



### 分析表工作流程(状态栈+符号栈+输入串+动作)

1. 状态栈初始化：#0
1. 符号栈初始为空
1. 输入串初始化：要分析的输入串
1. 动作：



查表：每次看状态栈栈顶和输入串最左边的符号，查对应

1. 遇到Sn，将n压入状态栈，将对应输入串的符号压入符号栈
1. 遇到rj，将符号栈对应的符号按j产生式归约，状态栈弹出$length(j产生式右部)$​个状态，同时压入goto对应的数字

注：对于冲突，右结合选移进，左结合选归约

## LR1



### 构造LR1活前缀DFA

向前搜索符(需要求first集)：

S->AB，AB都挪到左边后，相当于S挪到左边，未来必然面对的符号

搜索符号照抄

### LR1分析表

区别：

对于归约项目，$action(k,搜索符号)=rj$​

![image-20240629081341804](./images/image-20240629081341804.png)

### 判断LALR1文法

找同心项：，前面的项目都一样，然后合并

![image-20240629081640635](./images/image-20240629081640635.png)

归约归约冲突，不是LALR1：对于同一个搜索符号，有2个待约项目

![image-20240629081822552](./images/image-20240629081822552.png)

## LR0、LR1、SLR

不是LR0文法：一个状态中存在移进项目和归约项目，就是移进归约冲突

SLR解决移进归约冲突：

1. 构造集合1：所有移进项目的符号是一个集合，每个归约项目对应的左部的FOLLOW集
2. 只要集合两两不相交，就是SLR

