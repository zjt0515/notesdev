## 结构和原理



## 内部结构和引脚功能

CPU: 8位，

存储器：

1. ROM, 4kB
2. ram, 128B

IO接口

1. 并口，4个8bit
2. 串口
3. 定时计数器
4. 中断原

## CPU

>  CPU组成
>
> 1. 运算器
> 2. 控制器

### 运算器

1. 累加器A：8位寄存器，可以存放操作数
2. 寄存器B：8位辅助寄存器，为ALU乘除法运算设置
3. PSW程序状态字
    1. Cy进位标志位：算数/逻辑运算时有无进位/借位
    2. Ac辅助进位标志位：BCD运算时，低四位是否有进为/借位
    3. F0用户设定标志位: 控制程序流向
    4. RS1，RS0:选择片内RAM中的4组工作寄存器
    5. OV溢出标志位：有无溢出
    6. PSW.1:保留位
    7. P:奇偶标志位：A中1的个数是否为奇数，**数据用BCD表示**
4. 算术逻辑单元 ALU：8位变量进行算数/逻辑运算

### 控制器

1. 程序计数器PC：cpu**下一条**执行指令的地址，16位寄存器
2. IR指令寄存器：暂存指令，译码后由定时和控制电路发出控制信号
3. 指令译码器：
4. 堆栈指针SP：
5. 数据指针寄存器DPTR：16位寄存器，高位字节DPH，低位字节DPL

其他寄存器

1. DPTR，数据指针
2. SP 堆栈指针

时钟产生方式

1. 内部时钟方式
    1. 18、19引脚时钟接口
2. 外部时钟方式
    1. 18、19



单片机复位：使系统处于初始状态

```c
PC=0000H;
RAM=随机值;
SFR:
p0-p33=FFH;
SP=07H;
IP = IE = PCON = 0;
PSW=00H
```



看门狗定时器WDT：程序陷入死循环时，触发单片机复位

## 存储器组织

RAM: 内存

ROM：磁盘

1. 工作寄存器区







定时器/计数器 16位 3个 



中断系统



## 引脚

> [!tip]
>
> 引脚上方有横线：低电平有效

1. 电源及时钟引脚
2. 控制引脚
3. IO引脚

| 引脚           | id                                                        |      |
| -------------- | --------------------------------------------------------- | ---- |
| 电源及时钟引脚 | 18、19、Vss20、Vcc40                                      |      |
| 控制引脚       | 29、30、31、9                                             |      |
| IO引脚         | P0、P1、P2、P3 4个8位=32位<br />1-8, 10-17, 21-28， 32-39 |      |

地址线：16位，P0+P2，其中P0也可以作为数据线使用

电源及时钟与引脚

1. Vcc +5v
2. Vss GND
3. XTAL1  (19)
    1. 使用片内振荡器，，接外部石英晶体和微调电容
    2. 外接时钟源，接外部时钟振荡器信号
4. XTAL2 (18)
    1. 同上
    2. 外接时钟源时，悬空



控制引脚

1. PSEN(29): 片外程序存储器读选信号输出端
2. ALE/PROG(30): 
    1. ALE：地址锁存控制信号
    2. PROG片内flash编程时作为脉冲输入脚 
3. EA/VPP(31):
    1. EA: 外部程序存储器访问呃允许控制端
    2. Vpp 片内flash编程时接编程电压



IO引脚

1. P0:8位并行双向IO口，可以做地址线/数据线，分时复用
2. P1：准双向，引脚内部接有上拉电阻
3. P2：准双向
4. P3: 准双向，有第二功能

| P3   | 第二功能 | 注释                   |
| ---- | -------- | ---------------------- |
| P3.0 | RXD      | 串行口数据输入         |
| 1    | TXD      | 串行口数据输出         |
| 2    | INT0     | 外部中断0输入          |
| 3    | INT1     | 外部中断1输入          |
| 4    | T0       | 定时器0外部输入        |
| 5    | T1       | 定时器1外部输入        |
| 6    | WR       | 片外数据存储器写选通端 |
| 7    | RD       | 片外数据存储器读选通端 |

> [!tip]
>
> 双向和准双向：
>
> 准双向实际 是一种输出状态
>
> 双向在输入时，输出部分断开，端口浮空高祖态



## 单片机最小系统

用最基本最少的元件组成系统

1. 单片机芯片
2. 电源电路
3. 晶振电路
4. 复位电路