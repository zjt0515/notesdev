## 概述

1. **命令**界面
2. **程序**接口
3. **图形**界面

操作系统的4个特征

1. **并发**：两个或多个事件在同一**时间间隔**内发生(**并行是同一时刻**)
2. **共享**
3. **虚拟**:  将一个物理实体变为若干个逻辑对应物
4. **异步**(不确定性):  进程以**不可预知**的速度向前推进

## 进程

**进程关键要素**

1. 程序
2. 数据和栈
3. 进程控制块

> 进程基本三态模型的状态转换
>
> 1. 就绪 -> 运行：调度新进程运行
> 2. 运行 -> 就绪：**进程用完时间片**/被抢占被中断
> 3. 运行 -> 等待：初始化IO/对资源访问不能进行
> 4. 等待 -> 就绪：申请资源满足/等待的数据到达
>
> ```mermaid
> stateDiagram
> 		direction LR
>     [*] --> 就绪
>     就绪 --> 执行:进程调度
>     执行 --> 阻塞:IO请求
>     执行 --> 就绪:时间片完/进程被更高优先级抢占
>     阻塞 --> 就绪:IO请求完成
>     执行 --> [*]:终止
> ```
>

同步机制的遵循准则(临界区的使用原则)：

1. 空闲让进
2. 忙则等待
3. 有限等待，请求访问的进程能在有限时间内进入临界区
4. 让权等待，进程不能进入临界区时，立即释放处理器

## 存储

**动态分区分配算法（查找空闲区算法）**

| 算法                         | 描述                                                         | 空闲分区排列顺序           | 优缺点               |
| ---------------------------- | ------------------------------------------------------------ | -------------------------- | -------------------- |
| FF首次/最先适应              | 从**未分配区表/空闲区链**选择首个满足的                      | 按地址大小递增排列         | 性能好，开销小       |
| NF邻近适应算法(循环首次适应) | 从上次查找结束位置继续查找首个满足的                         | 同上                       |                      |
| BF最佳适应算法               | 从**未分配区表/空闲区链**选择首个满足的                      | 按容量递增形成分区链       | 会产生很多外部碎片   |
| WF最大/最坏适应算法          | 先检查第一个空闲区是否满足，若满足就从该空闲区划分一个与作业大小一致的内存空间，剩余的空闲区仍然留在表中 | 空闲分区按容量递减次序链接 | 不利于后续大进程使用 |

覆盖：将程序分为多个段，只有常用段常驻内存
对程序员透明，对用户不透明，只用于早期操作系统

1. 内存划分为一个固定区和若干个覆盖区
2. 固定区：常用段
3. 覆盖区：不常用的段

交换：

1. 换出：将处于等待的进程和被CPU剥夺运行权限的进程移出内存，进程状态变为挂起
2. 换入：将准备好竞争CPU的进程移入内存

## IO

## IO控制方式

1. 程序直接控制
2. 中断驱动方式
3. DMA方式
4. 通道方式

| 控制方式     | 描述                                                         | 优缺点                                             |
| ------------ | ------------------------------------------------------------ | -------------------------------------------------- |
| 程序直接控制 | 每次读一个字的数据，cpu循环检查                              | 简单易于实现，CPU利用率低(cpu和io设备只能串行工作) |
| 中断驱动方式 | 允许IO设备主动中断CPU运行，并请求服务<br />IO中断属于**外中断** |                                                    |
| DMA方式      | 在IO设备和内存之间开辟直接数据交换通道                       | 解放CPU                                            |
| 通道方式     | 通道：专门负责输入输出操作的处理器, 使IO操作组织和传送最大限度独立运行, 无需处理机干预 | **比DMA方式效率高**，**CPU干预最少**               |

## 文件

### 文件物理结构

> 文件如何分配磁盘块
>
> 在**外部设备**上的文件组织形式

1. **顺序**结构
2. 链接结构
3. **索引**结构
   1. 一级索引
   2. 多级索引
   3. 混合索引

| 分配方式          |                                                              | 优缺点                                                       |
| ----------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 连续分配/顺序结构 |                                                              | 支持顺序/随机访问，顺序存取容易; **速度快**<br />容易产生外部碎片，磁盘利用率低; **需要事先知道文件长度**，无法实行文件动态增长 |
| 链接分配          | 隐式链接：目录项记录文件名、对应的起始和结束块号。(除了最后一个)每个盘块都有指向下一盘快的指针<br />显式链接：FAT表存放指向下一个盘块的指针，链接文件的各盘块指针显式存放在FAT | 无需连续的存储空间; 无外部碎片; 无需事先知道文件长度; 便于文件增删改<br />隐式链接：只支持顺序访问; 可靠性差; 不便于直接存取<br />显式链接：FAT占用额外内存空间; 不支持告诉随机存取；不便于直接存取 |
| 索引分配          | 每个文件建立索引表，记录文件的所有盘块记录                   | 适合随机访问，易于文件拓展                                   |