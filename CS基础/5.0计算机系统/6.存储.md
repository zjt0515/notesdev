# 存储器

存储器分类

| 存储器              | 位置              | 功能特点 |      |
| ------------------- | ----------------- | -------- | ---- |
| 寄存器Regs          | CPU内             |          |      |
| 高速缓存Cache       | CPU内/附件        |          |      |
| 内存储器/主存储器mm | CPU之外，主板内存 |          |      |
| 外存储器am          | 主机之外          |          |      |

## 存储器层次结构

| 存储器                          |      |      |      |
| ------------------------------- | ---- | ---- | ---- |
| Regs                            |      |      |      |
| L1 cache                        |      |      |      |
| L2 cache                        |      |      |      |
| L3 cache                        |      |      |      |
| 主存储                          |      |      |      |
| local secondary storage         |      |      |      |
| remote 分布式文件系统/web服务器 |      |      |      |



## RAM随机访问存储器

1. static ram(sram)
2. dynamic ram(dram)

## 半导体随机存取存储器



## 外部存储器

### 磁盘扇区访问时间

$$
T=平均寻道时间+平均旋转等待时间+数据传输时间\\
=...+\frac{1*60s}{2RPM*1min}+
$$

> [!ques]
>
> 假定每个扇区512字节， 磁盘转速为5400 RPM，平均寻道时间（最大寻道时间的一半）为12 ms, 数据传输率为4 MB/s, 则磁盘扇区访问时间为多少？
> $$
> T=12+60/5400/2 + 512/4000B/s
> $$
> 



### 逻辑磁盘块

现代磁盘构造：一个个B个扇区大小的逻辑块 的序列，编号0 ~  B-1

磁盘控制器：逻辑块号

IO操作：

1. 发送命令到磁盘控制器，读某个逻辑块号
2. 控制器将逻辑块号翻译为`(柱面，盘面，扇区)`的三元组，移动到对应柱面，等待扇区移动到读写头下
    读写头感知到的位放入控制器的缓冲区中，然后复制到主存



> [!ques]
>
> 磁盘组有6片磁盘，每片有两个记录面，最上最下两个面不用。存储区域内径22cm，外径33cm，道密度为40道/cm，内层位密度400位/cm，转速6000转/分。问：
>
>         (1) 共有多少柱面？  (2) 盘组总存储容量是多少？ (3) 数据传输率多少？
> 解：(1)  有效存储区域 = (33-22)/2=5.5(cm)     
>                因为道密度 = 40道/cm，所以40×5.5 = 220道，即220个圆柱面        
>          (2) 内层磁道周长为2R = 2×3.14×11=69.08(cm)    
>                每道信息量 = 400位/cm×69.08cm = 27632位 = 3454B
>                每面信息量 = 3454B×220 = 759880B    
>                盘组总容量 = 759880B×(6×2-2) = 7598800B
>          (3) 磁盘数据传输率Dr = rN，N为每条磁道容量，N=3454B，r为磁盘转速，r=6000转/60秒=100转/秒 
>                Dr = rN = 100×3454B=345400B/s

## 高速缓存存储器cache

### Cache映射

> 将主存块存到cache中，
>
> cache行比主存块少，多个主存块映射同一cache行

如何映射

- 主存空间划分为大小相等的主存块
- cache中存放主存块的单位：槽/行

映射方式

1. 直接映射：每个主存块映射到cache的固定行
2. 全相联：映射到cache的任一行
3. 组相连：映射到cache固定组中任一行

## 主存MM

### 逻辑地址和物理地址

> 虚拟地址：程序中指令所用的地址/进程所在的地址空间 都是虚拟地址
>
> 逻辑地址空间：
>
> 物理地址：存放指令的实际主存地址

### 页表

> 页表：虚拟页  映射 物理页