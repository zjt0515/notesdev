## 事务

事务将一组操作作为一个整体，一起向系统提交或撤销，要么同时成功，要么同时失败。

手动开启事务，手动提交事务，如果抛异常，要手动回滚事务

### 事务操作

```sql
-- 转账操作 1.查询 2.减去 3.加上
select * from account where name = 'zs'
update account set money = money - 1000 where name = 'zs'
update account set money = money + 1000 where name = 'ls'
```

查看/设置事务提交方式

```sql
select @@autocommit; -- 查询事务提交方式1自动0手动
set @@autocommit=0;
```

如果执行成功，提交事务

```sql
commit;
```

如果执行失败，回滚数据

```sql
rollback;
```



#### 操作方式二

无需设置事务提交方式

```sql
begin;
commit;
rollback;
```



## 事务四大特性

1. 原子性

    事务是不可分割的最小操作单元

2. 一致性

    事务完成时，必须使所有数据都保持一致状态

3. 隔离性

    数据库系统提供的隔离机制
    保证事务不受外部并发操作影响

4. 持久性

    事务一旦提交或回滚，对数据的改变是永久的

## 并发事务引发的问题

脏读：一个事务读到另一个事务还未提交的数据

不可重复读：一个事务先后读取同一条记录，两次读取的数据不同(第一次读时另一个事务未提交更新，第二次读时另一个事务已经提交更新)

幻读：没有查询到对应数据行，插入时，数据又存在了(查询时另一个事务没有提交插入，插入时另一个事务已经提交插入)

## 事务的隔离级别

 

| 隔离级别         | 脏读 | 不可重复读 | 幻读 | 注意 |
| ---------------- | ---- | ---------- | ---- | ---- |
| Read uncommitted |      |            |      |      |
| Read committed   |      |            |      |      |
| Repeatable Read  |      |            |      |      |
| Serializable     |      |            |      |      |

todo....