## 项目需求分析

1. 用户痛点问题
2. 用户功能的最小闭环
3. 辅助最小闭环实现到项目上线，需要的技术和方案



- 接口服务：可靠可拓展的web服务，集成数据库+redis
- 实现最小闭环：CURD，登录注册认证、权限控制
- 服务部署与测试：文档



## 项目技术栈

1. NestJS + TS
2. TypeORM
3. Vue + Bootstrap



## 分层思想

1. Controller 处理请求返回响应
2. Service 提供方法和操作，只包含业务逻辑
3. DataAccess 访问数据

## 接口服务流程

1. 请求数据校验Pipe
2. 请求认证(鉴权设计)Guard
3. 路由Controller
4. 功能逻辑Service
5. 数据库操作Repository

## NestJS核心概念

1. 控制器：处理请求
2. 服务：数据访问和核心逻辑
3. 模块
4. 管道：核验请求数据
5. 过滤器：处理请求时的错误
6. 守卫：认证+鉴权
7. 拦截器：给请求和响应加入额外逻辑
8. 存储库

### Nestjs生命周期

## 通用后端框架思考

### 开发层面

数据库生产和开发环境配置

通用模块：用户、权限、菜单、日志

接口文档、接口请求安全&性能



### 功能层面

 

### 接口安全层面

## 多环境配置

### dotenv

```
npm i dotenv
```

```.env
TOEKN_SECRET=your-long-random-secrest

USERNAME=tomic
// 嵌套类型数据不方便
DATABASE_USERNAME=username
DATABASE_PASSWORD=password
```

```js
require('dotenv').config()

consoloe.log(process.env)
```

### config

支持json、js-yaml

```shell
pnpm i config 
pnpm i js-yaml
pnpm i -D @types/js-yaml
```

config/defalut.json

```json
{
  "token_secret": "long-secrest",
  "db": {
    "host": "localhsot",
  }
}
```

config/production.json

```js
{
  "token_secret": "long-secrest",
  "db": {
    "host": "production-host",
  }
}
```

`set NODE_ENV=production`



```js
const config = require('config');
const dbConfig = config.get('db');
console.log(dbConfig)
```

### cross-env

```
pnpm i -D cross-env
```

```json
    "start:dev": "cross-env NODE_ENV=development nest start --watch",
    "start:prod": "cross-env NODE_ENV=production node dist/main",
```

cross-env NODE_ENV=production

cross-env NODE_ENV=development

###  @nestjs/config

```shel
pnpm i --save @nestjs/config
// 使用yaml 
pnpm i js-yaml
pnpm i -D @types/js-yaml
pnpm i loadsh
```

方案一：使用.env

1. .env 公共配置
2. .env.develeopment 开发环境配置
3. env.production 生产环境配置

特定环境配置的同名配置 会覆盖公共配置



方案二：使用yml格式

1. ./config/config.yml
2. ./config/config.development.yml
3. ./config/config.production.yml

```ts
// /src/configuration.ts

```

